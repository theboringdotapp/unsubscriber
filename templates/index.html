{% extends 'base.html' %}

{% block title %}Unsubscriber Dashboard{% endblock %}

{% block content %}

<!-- Authenticated users see the scan interface/dashboard -->
<div class="content-container">
    <div class="mb-8 text-center">
        <h1 class="text-3xl font-bold text-foreground fade-in-up">Your Inbox Dashboard</h1>
        <p class="text-muted-foreground mt-2 fade-in-up animation-delay-100">Ready to find and manage your subscriptions</p>
    </div>
    
    <div class="flex justify-center mb-10 fade-in-up animation-delay-200">
        <a href="{{ url_for('scan.scan_emails') }}"
           id="scan-button"
           onclick="startScan()" 
           class="btn btn-brand btn-lg focus-ring shadow-lg shadow-brand/20 hover:shadow-xl hover:shadow-brand/30 hover:-translate-y-0.5 transition-all flex items-center">
            Scan Inbox Now
        </a>
    </div>
    
    <!-- Skeleton Subscription List (Placeholder for initial view) -->
    <div id="skeleton-list" class="space-y-4 max-w-4xl mx-auto fade-in-up animation-delay-300">
        <!-- Skeleton Sender Groups -->
        {% for i in range(3) %}
        <div class="sender-group skeleton-sender">
            <div class="sender-header">
                <div class="flex items-center gap-2">
                    <div class="h-4 w-4 bg-muted rounded"></div>
                    <div class="h-5 bg-muted rounded w-40"></div>
                </div>
                <div class="h-5 w-5 bg-muted rounded"></div>
            </div>
            <div class="sender-emails">
                {% for j in range(3) %}
                <div class="email-row skeleton-email">
                    <div class="flex items-center flex-1 min-w-0 mr-4">
                        <div class="h-4 w-4 bg-muted rounded mr-3"></div>
                        <div class="h-4 bg-muted rounded w-full max-w-md"></div>
                    </div>
                    <div class="h-3 bg-muted rounded w-16"></div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Scan Loader div removed -->

</div>

{% endblock %}

{% block footer %}
{{ super() }} 
{% endblock %}

{% block scripts %}
<!-- Style block removed, styles are now in css/styles.css -->
<script>
    // Function to handle scan button click and show loader
    function startScan() {
        const skeletonList = document.getElementById('skeleton-list');
        // scanLoader element is removed
        const scanButton = document.getElementById('scan-button');
        
        if (skeletonList && scanButton) { // Check only for skeletonList and scanButton
            // Disable the button and change text ONLY
            scanButton.disabled = true;
            scanButton.classList.add('is-loading', 'opacity-60', 'cursor-not-allowed'); // Add loading state classes
            scanButton.textContent = 'Scanning...'; // Change text

            // Add loading animation class to skeleton
            skeletonList.classList.add('skeleton-loading');

            // Remove logic that hides skeletonList and shows scanLoader
            // skeletonList.style.transition = 'opacity 0.5s ease';
            // skeletonList.style.opacity = '0';
            // setTimeout(() => {
            //     skeletonList.style.display = 'none';
            //     scanLoader.classList.remove('hidden');
            //     scanLoader.classList.add('fade-in'); 
            // }, 500);
            
            // Allow the form submission (link navigation) to proceed
            return true; 
        }
        
        // Fallback if elements not found
        return true;
    }
</script>
{% endblock %} 